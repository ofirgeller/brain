function getPointsOnPath(t){for(var n=10,o=[],r=t.getTotalLength(),i=r/n,e=-i,s=0;s<n;s++)e+=i,o.push(t.getPointAtLength(e));return o}function findNClosestNeurons(t,n){var o=neurons[t],r=neurons.filter(function(t){return t.id!==o.id}).map(function(t,n,r){return{idx:n,distance:distance(t.pos,o.pos)}}).sort(function(t,n){return t.distance-n.distance}).filter(function(t,o){return o<n});return r}function distance(t,n){return Math.sqrt(Math.pow(t.x-n.x,2)+Math.pow(t.y-n.y,2))}function pointsAsString(t){t.map(function(t){return t.x+","+t.y+" "}).join("")}function poissonDiscSampler(t,n,o){function r(t,n){var o=t/h|0,r=n/h|0,i=Math.max(o-2,0),e=Math.max(r-2,0),s=Math.min(o+3,c),u=Math.min(r+3,f);for(r=e;r<u;++r){var d=r*c;for(o=i;o<s;++o)if(l=p[d+o]){var l,x=l[0]-t,v=l[1]-n;if(x*x+v*v<a)return!1}}return!0}function i(t,n){var o=[t,n];return d.push(o),l.push(o),p[c*(n/h|0)+(t/h|0)]=o,++v,++x,o}var e=30,s=o,a=o*o,u=3*a,h=o*Math.SQRT1_2,c=Math.ceil(t/h),f=Math.ceil(n/h),p=new Array(c*f),d=[],l=[],x=0,v=0;return function(){if(!v)return i(Math.random()*t,Math.random()*n);for(;x;){for(var h=Math.random()*x|0,c=d[h],f=0;f<e;++f){var p=2*Math.PI*Math.random(),m=Math.sqrt(Math.random()*u+a),M=c[0]+m*Math.cos(p),g=c[1]+m*Math.sin(p);if(0<=M&&M<t&&0<=g&&g<n&&r(M,g))return i(M,g)}d[h]=d[--x],d.length=x,0===x&&.7*s<o&&(d=l,x=l.length,o=.7*o,a=o*o)}}}var d;!function(t){}(d||(d={}));var Pos=function(){function t(t,n){this.x=t,this.y=n}return t}(),neurons=[],axons=[],config={bgColor:"#0D0D0D",axonStroke:"#8e8e8e",neuronCount:55,axonCount:10,axonStrokeWidth:1},nextId=function(t){return void 0===t&&(t=0),function(){var n=t;return t++,n}}(),Neuron=function(){function t(t,n){var o=this;void 0===n&&(n=1),this.pos=t,this.size=n,this.inputAxons=[],this.outputAxons=[],this.id=nextId(),this.elm=ctx.circle(t.x,t.y,n).attr({fill:colors.LighterGray,stroke:colors.Charcoal,strokeWidth:1}),this.elm.click(function(t){o.outputAxons.forEach(function(t){return t.fire()})})}return t.prototype.poke=function(){this.outputAxons.forEach(function(t){var n=Math.round(Math.random());n&&t.fire()})},t}(),Axon=function(){function t(t,n){this.first=t,this.second=n,this.id=nextId(),this.startNeuron=t,this.endNeuron=n,this.startNeuron.outputAxons.push(this),this.endNeuron.inputAxons.push(this);var o=Math.ceil(20*Math.random())+10,r=[1,-1][Math.round(1*Math.random())],i=o*r,e=t.pos.x+" "+t.pos.y,s=n.pos.x+" "+n.pos.y,a=(t.pos.x+n.pos.x)/2,u=(t.pos.y+n.pos.y)/2,h=a+i+" "+(u+i);this.elm=ctx.path("M "+e+" C "+e+", "+h+", "+s),this.addAttrib(this.elm),this.pathPoints=getPointsOnPath(this.elm)}return t.prototype.addAttrib=function(t){t.attr({fill:"none",stroke:config.axonStroke,strokeWidth:config.axonStrokeWidth,"z-index":-1}).addClass(".no-click")},t.prototype.fire=function(){var t,n=this,o=0,r=this.pathPoints[o],i=setInterval(function(){t||(t=ctx.circle(r.x,r.y,3).attr({fill:colors.Orange,stroke:"#00ce68"})),o++,r=n.pathPoints[o],r?t.animate({cx:r.x,cy:r.y},90):(clearInterval(i),t.remove(),n.endNeuron.poke())},100)},t}(),jSvg=$("#network"),svg=jSvg.get(0),ctx=Snap(svg);ctx.attr({fill:config});for(var samples=poissonDiscSampler(jSvg.width(),jSvg.height(),65),j=0;j<config.neuronCount;j++){var sample=samples();if(!sample||!sample[0])break;var size=Math.ceil(2*Math.random())+3,neuron=new Neuron(new Pos(sample[0],sample[1]),size);neurons.push(neuron)}for(var j=0;j<neurons.length;j++)for(var first=neurons[j],connections=0,options=findNClosestNeurons(j,4),i=0;i<options.length&&connections<2;i++){var second=neurons[options[i].idx];if(!second.outputAxons.some(function(t){return t.endNeuron.id===first.id})){var axon=new Axon(first,second);axons.push(axon),connections++}}